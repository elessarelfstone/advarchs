language: python
env:
  global:
  - POETRY_VERSION=0.12.17
  - ADVARCHS_ENV=build
  - ADVARCHS_DOCKER_IMAGE=elessarelfstone/advarchs
matrix:
  include:
    - name: "Python 3.6 on Ubuntu 18.04 Bionic"
      dist: bionic
      os: linux
      python: 3.6
    - name: "Python 3.7 on Ubuntu 18.04 Bionic"
      dist: bionic
      os: linux
      python: 3.7
    - name: "Python 3.8-dev on Ubuntu 18.04 Bionic"
      dist: bionic
      os: linux
      python: 3.8-dev
    - name: "Python 3.7 on Alpine"
      sudo: required
      services:
        - docker
      before_install:
        - docker image build --build-arg ADVARCHS_ENV=$ADVARCHS_ENV -t $ADVARCHS_DOCKER_IMAGE .
      install: []
      script:
        - docker run --rm $ADVARCHS_DOCKER_IMAGE
    - name: "Python 3.7 on Windows"
      os: windows
      language: shell
      before_install:
        - choco install python
        - python -m pip install --upgrade pip
        - choco install 7zip
        - pip3 install -q poetry==$POETRY_VERSION
      script:
        - poetry run pytest
      env: PATH=/c/Python37:/c/Python37/Scripts:$PATH
      

before_install:
- pip install -q poetry==$POETRY_VERSION
- sudo apt-get install p7zip-full p7zip-rar
install:
- poetry install
script:
- pytest